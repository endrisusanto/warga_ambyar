<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>

    <!-- Open Graph -->
    <meta property="og:title" content="<%= title %>">
    <meta property="og:description" content="Jadwal Ronda dan Dokumentasi Warga Ambyar">
    <% if(ogImage) { %>
        <meta property="og:image" content="<%= process.env.APP_URL || '' %><%= ogImage %>">
        <meta property="og:image:width" content="800">
        <meta property="og:image:height" content="400">
        <% } %>

            <script src="https://cdn.tailwindcss.com"></script>
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
                rel="stylesheet">
            <style>
                body {
                    font-family: 'Inter', sans-serif;
                }
            </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="max-w-2xl w-full bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-indigo-600 px-6 py-4 flex justify-between items-center text-white">
            <h1 class="text-sm font-bold">
                <%= dateLabel %>
            </h1>
            <% if(teamName) { %>
                <span class="px-3 py-1 bg-white text-indigo-600 rounded-full text-[10px] font-bold">Tim <%= teamName %>
                </span>
                <% } %>
        </div>

        <div class="p-6">
            <h2 class="text-[10px] font-semibold text-gray-500 uppercase tracking-wide mb-4">Anggota Bertugas</h2>
            <ul class="space-y-4">
                <% schedule.forEach(s=> { %>
                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-2 h-2 rounded-full <%= s.status === 'hadir' ? 'bg-green-500' : (s.status === 'izin' ? 'bg-yellow-400' : (s.status === 'alpa' ? 'bg-red-500' : 'bg-gray-300')) %>">
                            </div>
                            <div>
                                <div class="text-xs font-bold text-gray-800">
                                    <%= s.nama %>
                                </div>
                                <div class="text-[9px] text-gray-500">Blok <%= s.blok %>-<%= s.nomor_rumah %>
                                </div>
                            </div>
                        </div>
                        <% if(s.status && s.status !=='scheduled' ) { %>
                            <span
                                class="text-[9px] font-bold uppercase <%= s.status === 'hadir' ? 'text-green-600' : 'text-gray-500' %>">
                                <%= s.status %>
                            </span>
                            <% } %>
                    </li>
                    <% }) %>
            </ul>

            <h2 class="text-[10px] font-semibold text-gray-500 uppercase tracking-wide mt-6 mb-4">Dokumentasi & Bukti</h2>
            <% if(allPhotos && allPhotos.length> 0) { %>
                <div class="grid grid-cols-4 gap-2">
                    <% allPhotos.slice(0, 8).forEach(p=> { %>
                        <div class="aspect-square bg-gray-200 rounded-lg overflow-hidden relative border">
                            <% if(p.src && String(p.src).match(/\.(mp4|mov|avi|webm)$/i)) { %>
                                <video src="/uploads/ronda/<%= p.src %>#t=1.0"
                                    class="w-full h-full object-cover"></video>
                                <div
                                    class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 text-white font-bold">
                                    â–¶</div>
                                <% } else { %>
                                    <img src="/uploads/ronda/<%= p.src %>" class="w-full h-full object-cover">
                                    <% } %>
                        </div>
                        <% }) %>
                            <% if(allPhotos.length> 8) { %>
                                <div
                                    class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center text-gray-400 text-[10px] font-bold">
                                    +<%= allPhotos.length - 8 %>
                                </div>
                                <% } %>
                </div>
                <% } else { %>
                    <p class="text-gray-400 text-xs italic border-l-2 border-gray-300 pl-3">Belum ada dokumentasi.</p>
                    <% } %>
        </div>

        <div class="bg-gray-50 px-6 py-4 border-t flex justify-between items-center">
            <div class="text-[10px] text-gray-400">Warga Ambyar System</div>
            <div class="flex space-x-3">
                <button onclick="copyLink()"
                    class="flex items-center px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm text-[10px] font-medium hover:bg-gray-50 text-gray-700 transition">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                        </path>
                    </svg>
                    Copy Link
                </button>
                <button onclick="shareWa()"
                    class="flex items-center px-4 py-2 bg-green-500 text-white rounded-lg shadow-sm text-[10px] font-medium hover:bg-green-600 transition">
                    Share WA
                </button>
            </div>
        </div>
    </div>

    <script>
        function copyLink() {
            navigator.clipboard.writeText(window.location.href).then(() => alert('Link copied!'));
        }
        function shareWa() {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent('Cek Jadwal Ronda: ' + document.title);
            window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
        }
    </script>

</body>

</html>