<%- include('../partials/head') %>
    <%- include('../partials/navbar') %>

        <div class="container mx-auto px-4 py-8 pb-24 md:pb-8">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Layanan Pengaduan</h1>
                    <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">Sampaikan aspirasi dan keluhan Anda</p>
                </div>
                <a href="/pengaduan/create"
                    class="bg-white hover:bg-gray-50 text-gray-900 border border-gray-200 shadow-lg px-4 py-2 rounded-lg font-medium transition flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span class="hidden sm:inline">Buat Pengaduan</span>
                    <span class="sm:hidden">Baru</span>
                </a>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-8">
                <div class="glass-card p-4 text-center">
                    <div class="text-[10px] text-gray-600 dark:text-gray-400 uppercase tracking-wider mb-1">Total Aduan
                    </div>
                    <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
                        <%= stats.total %>
                    </div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-[10px] text-yellow-400 uppercase tracking-wider mb-1">Pending</div>
                    <div class="text-2xl font-bold text-yellow-500">
                        <%= stats.pending %>
                    </div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-[10px] text-blue-400 uppercase tracking-wider mb-1">Proses</div>
                    <div class="text-2xl font-bold text-blue-500">
                        <%= stats.proses %>
                    </div>
                </div>
                <div class="glass-card p-4 text-center">
                    <div class="text-[10px] text-emerald-400 uppercase tracking-wider mb-1">Selesai</div>
                    <div class="text-2xl font-bold text-emerald-500">
                        <%= stats.selesai %>
                    </div>
                </div>
            </div>

            <!-- List -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <% if(complaints.length===0) { %>
                    <div
                        class="col-span-full text-center py-12 text-gray-500 glass-card rounded-xl border border-dashed border-white/10">
                        <svg class="w-12 h-12 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                            </path>
                        </svg>
                        <p>Belum ada pengaduan yang masuk.</p>
                    </div>
                    <% } %>
                        <% complaints.forEach(c=> { %>
                            <div class="glass-card rounded-2xl overflow-hidden hover:bg-gray-200 dark:bg-white/10 transition-all group cursor-pointer"
                                onclick="window.location.href='/pengaduan/<%= c.id %>'">
                                <!-- Image Section -->
                                <% if(c.foto) { %>
                                    <div class="relative h-40 overflow-hidden">
                                        <img src="<%= c.foto %>"
                                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                            alt="<%= c.judul %>">
                                        <div class="absolute top-3 right-3">
                                            <span class="text-white text-xs font-bold px-3 py-1 rounded-full
                                        <%= c.status === 'pending' ? 'bg-yellow-500/90' : 
                                            c.status === 'proses' ? 'bg-blue-500/90' : 
                                            c.status === 'selesai' ? 'bg-emerald-500/90' : 'bg-red-500/90' %>">
                                                <%= c.status %>
                                            </span>
                                        </div>
                                    </div>
                                    <% } else { %>
                                        <div
                                            class="h-32 bg-gradient-to-br from-indigo-500/20 to-purple-600/20 flex items-center justify-center relative">
                                            <svg class="w-12 h-12 text-gray-500" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
                                                </path>
                                            </svg>
                                            <div class="absolute top-3 right-3">
                                                <span class="text-white text-xs font-bold px-3 py-1 rounded-full
                                        <%= c.status === 'pending' ? 'bg-yellow-500/90' : 
                                            c.status === 'proses' ? 'bg-blue-500/90' : 
                                            c.status === 'selesai' ? 'bg-emerald-500/90' : 'bg-red-500/90' %>">
                                                    <%= c.status %>
                                                </span>
                                            </div>
                                        </div>
                                        <% } %>

                                            <!-- Content Section -->
                                            <div class="p-4">
                                                <h3
                                                    class="text-base font-bold text-gray-900 dark:text-gray-100 mb-2 line-clamp-2">
                                                    <%= c.judul %>
                                                </h3>
                                                <p class="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2">
                                                    <%= c.deskripsi %>
                                                </p>

                                                <div
                                                    class="flex items-center justify-between text-xs text-gray-500 pt-3 border-t border-white/5">
                                                    <div class="flex items-center gap-1">
                                                        <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z">
                                                            </path>
                                                        </svg>
                                                        <% if (c.is_anonim && c.nama_warga) { const
                                                            words=c.nama_warga.split(' ');
                                                            const parts = words.map(w => {
                                                                if (w.length <= 1) return { first: w, blur: '' };
                                                                return { first: w[0], blur: w.substring(1) };
                                                            });
                                                        %>
                                                            <% parts.forEach((part, idx) => { %><%= part.first %><% if (part.blur) { %><span class="blur-sm select-none" style="filter: blur(4px)"><%= part.blur %></span><% } %><% if (idx < parts.length - 1) { %> <% } %><% }); %>
                                                        <% } else { %>
                                                            <%= c.nama_warga || ' User' %>
                                                            <% } %>
                                                    </div>
                                                    <div class="flex items-center gap-1">
                                                        <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                            viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2"
                                                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        <%= c.formattedDate %>
                                                    </div>
                                                </div>
                                            </div>
                            </div>
                            <% }) %>
            </div>
        </div>

        <%- include('../partials/footer') %>